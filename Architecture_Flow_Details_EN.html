<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Appendix 2. System Architecture Detailed Flow Diagrams and Component Interactions - GenoCorr Platform System Architecture</title>
    <style>
        @media print {
            @page {
                size: A4;
                margin: 2.5cm 2cm;
            }
            
            body {
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }
            
            .no-print {
                display: none;
            }
            
            h1, h2, h3, h4, h5, h6 {
                page-break-after: avoid;
            }
            
            pre, blockquote, table {
                page-break-inside: avoid;
            }
            
            .flow-diagram {
                page-break-inside: avoid;
            }
        }
        
        body {
            font-family: "Microsoft YaHei", "SimHei", "Arial Unicode MS", "DejaVu Sans", Arial, sans-serif;
            line-height: 1.8;
            color: #333;
            font-size: 12pt;
            max-width: 210mm;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
        }
        
        .print-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #3498db;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14pt;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        
        .print-button:hover {
            background-color: #2980b9;
        }
        
        h1 {
            font-size: 28pt;
            font-weight: bold;
            color: #2c3e50;
            margin-top: 1.5em;
            margin-bottom: 0.8em;
            border-bottom: 3px solid #3498db;
            padding-bottom: 0.5em;
        }
        
        h2 {
            font-size: 22pt;
            font-weight: bold;
            color: #34495e;
            margin-top: 1.5em;
            margin-bottom: 0.6em;
            border-bottom: 2px solid #95a5a6;
            padding-bottom: 0.3em;
        }
        
        h3 {
            font-size: 18pt;
            font-weight: bold;
            color: #34495e;
            margin-top: 1.3em;
            margin-bottom: 0.5em;
        }
        
        h4 {
            font-size: 16pt;
            font-weight: bold;
            color: #34495e;
            margin-top: 1.2em;
            margin-bottom: 0.4em;
        }
        
        h5, h6 {
            font-size: 14pt;
            font-weight: bold;
            color: #34495e;
            margin-top: 1em;
            margin-bottom: 0.3em;
        }
        
        p {
            margin: 0.8em 0;
            text-align: justify;
        }
        
        code {
            background-color: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: "Consolas", "Monaco", "Courier New", monospace;
            font-size: 10.5pt;
            color: #c7254e;
            border: 1px solid #e1e1e1;
        }
        
        pre {
            background-color: #f8f8f8;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border-left: 4px solid #3498db;
            margin: 1em 0;
            font-family: "Consolas", "Monaco", "Courier New", monospace;
            font-size: 10pt;
            line-height: 1.5;
        }
        
        pre code {
            background-color: transparent;
            padding: 0;
            border: none;
            color: #333;
            font-size: 10pt;
            display: block;
            white-space: pre;
            overflow-x: auto;
        }
        
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 1.5em 0;
            font-size: 11pt;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        
        th {
            background-color: #3498db;
            color: white;
            font-weight: bold;
            text-align: center;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        ul, ol {
            margin: 0.8em 0;
            padding-left: 2em;
        }
        
        li {
            margin: 0.4em 0;
        }
        
        blockquote {
            border-left: 4px solid #3498db;
            margin: 1.5em 0;
            padding-left: 1.5em;
            padding-right: 1em;
            color: #555;
            font-style: italic;
            background-color: #f9f9f9;
            padding-top: 0.5em;
            padding-bottom: 0.5em;
        }
        
        hr {
            border: none;
            border-top: 2px solid #ddd;
            margin: 2em 0;
        }
        
        strong {
            font-weight: bold;
            color: #2c3e50;
        }
        
        em {
            font-style: italic;
            color: #555;
        }
        
        .toc {
            background-color: #f9f9f9;
            padding: 1.5em;
            margin: 1.5em 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .toc ul {
            list-style-type: none;
            padding-left: 1em;
        }
        
        .toc li {
            margin: 0.3em 0;
        }
        
        .toc a {
            color: #3498db;
            text-decoration: none;
        }
        
        .toc a:hover {
            text-decoration: underline;
        }
        
        /* Flow diagram styles */
        .flow-diagram {
            background-color: #f8f8f8;
            padding: 15px;
            border-radius: 5px;
            margin: 1.5em 0;
            border: 1px solid #ddd;
            font-family: "Consolas", "Monaco", "Courier New", monospace;
            font-size: 10pt;
            overflow-x: auto;
            white-space: pre;
        }
        
        /* Special characters in code blocks */
        pre.highlight, pre code {
            white-space: pre;
            word-wrap: normal;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <button class="print-button no-print" onclick="window.print()">
        ğŸ–¨ï¸ Print to PDF
    </button>
    
    <h1 id="system-architecture-detailed-flow-diagrams-and-component-interactions">Appendix 2. System Architecture Detailed Flow Diagrams and Component Interactions<a class="headerlink" href="#system-architecture-detailed-flow-diagrams-and-component-interactions" title="Permanent link">&para;</a></h1>
<p>This document provides detailed flow diagrams for each step of the system architecture and the interactions between components.</p>
<hr />
<h2 id="i-system-startup-flow">I. System Startup Flow<a class="headerlink" href="#i-system-startup-flow" title="Permanent link">&para;</a></h2>
<h3 id="11-backend-startup-flow">1.1 Backend Startup Flow<a class="headerlink" href="#11-backend-startup-flow" title="Permanent link">&para;</a></h3>
<pre><code>Step 1: Load Environment Variables
    â”‚
    â”œâ”€â†’ Read .env file
    â”œâ”€â†’ MONGODB_URI
    â”œâ”€â†’ VALID_TOKENS
    â””â”€â†’ Other configurations
    â”‚
Step 2: Connect to MongoDB
    â”‚
    â”œâ”€â†’ MongoClient(MONGODB_URI)
    â”œâ”€â†’ client.admin.command('ping')  # Test connection
    â”œâ”€â†’ db = client.gene_search_db
    â””â”€â†’ collection = db.gene_data
    â”‚
Step 3: Initialize API Classes
    â”‚
    â”œâ”€â†’ gene_api = GeneSearchAPI()
    â”‚     â”‚
    â”‚     â”œâ”€â†’ load_data_to_mongodb()
    â”‚     â”‚     â”‚
    â”‚     â”‚     â”œâ”€â†’ Scan data/*.xlsx files
    â”‚     â”‚     â”œâ”€â†’ Read each file
    â”‚     â”‚     â”œâ”€â†’ Data cleaning and transformation
    â”‚     â”‚     â”œâ”€â†’ Batch write to MongoDB
    â”‚     â”‚     â””â”€â†’ Create indexes
    â”‚     â”‚
    â”‚     â””â”€â†’ load_all_genes()
    â”‚           â”‚
    â”‚           â”œâ”€â†’ MongoDB aggregation query
    â”‚           â”œâ”€â†’ $group deduplication
    â”‚           â””â”€â†’ Return gene symbol list
    â”‚
    â”œâ”€â†’ ontology_api = GeneOntologyAPI()
    â”‚     â”‚
    â”‚     â”œâ”€â†’ gp = GProfiler(return_dataframe=True)
    â”‚     â””â”€â†’ themes = {...}  # Define theme keywords
    â”‚
Step 4: Create FastAPI Application
    â”‚
    â”œâ”€â†’ app = FastAPI(...)
    â”œâ”€â†’ app.add_middleware(CORSMiddleware, ...)
    â””â”€â†’ Define all API routes
    â”‚
Step 5: Start Uvicorn Server
    â”‚
    â””â”€â†’ uvicorn.run(app, host=&quot;0.0.0.0&quot;, port=8000)
</code></pre>
<h3 id="12-frontend-startup-flow">1.2 Frontend Startup Flow<a class="headerlink" href="#12-frontend-startup-flow" title="Permanent link">&para;</a></h3>
<pre><code>Step 1: Load Environment Variables
    â”‚
    â””â”€â†’ NEXT_PUBLIC_API_URL = process.env.NEXT_PUBLIC_API_URL
    â”‚
Step 2: Compile TypeScript
    â”‚
    â””â”€â†’ TypeScript â†’ JavaScript
    â”‚
Step 3: Next.js Startup
    â”‚
    â”œâ”€â†’ Initialize React application
    â”œâ”€â†’ Load routing configuration
    â””â”€â†’ Start development server (port 3000)
    â”‚
Step 4: Page Loading
    â”‚
    â”œâ”€â†’ layout.tsx (root layout)
    â””â”€â†’ page.tsx (home page)
</code></pre>
<hr />
<h2 id="ii-gene-search-module-detailed-flow">II. Gene Search Module Detailed Flow<a class="headerlink" href="#ii-gene-search-module-detailed-flow" title="Permanent link">&para;</a></h2>
<h3 id="21-complete-flow-of-data-loading-to-mongodb">2.1 Complete Flow of Data Loading to MongoDB<a class="headerlink" href="#21-complete-flow-of-data-loading-to-mongodb" title="Permanent link">&para;</a></h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Automatically executed on startup: GeneSearchAPI.__init__() â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Check if MongoDB already has data          â”‚
â”‚                                                      â”‚
â”‚ existing_count = collection.count_documents({})     â”‚
â”‚ if existing_count &gt; 0:                              â”‚
â”‚     print(&quot;Data already exists, skip loading&quot;)      â”‚
â”‚     return                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Scan data file directory                   â”‚
â”‚                                                      â”‚
â”‚ excel_files = glob.glob(&quot;data/*.xlsx&quot;)              â”‚
â”‚ # Result: ['data/BoneMarrow.xlsx', ...]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Iterate through each Excel file            â”‚
â”‚                                                      â”‚
â”‚ for file_path in excel_files:                       â”‚
â”‚     # Process single file                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Read Excel file                            â”‚
â”‚                                                      â”‚
â”‚ df = pd.read_excel(file_path)                       â”‚
â”‚ # DataFrame structure:                              â”‚
â”‚ # Columns: Gene_symbol, Gene_name, P_value_...,   â”‚
â”‚ #          FDR_..., Ratio_..., Fold_change_...,   â”‚
â”‚ #          LSMean10mgkg_..., LSMeancontrol_...     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: Extract organ name                         â”‚
â”‚                                                      â”‚
â”‚ organ_name = os.path.splitext(                      â”‚
â”‚     os.path.basename(file_path)                     â”‚
â”‚ )[0]                                                â”‚
â”‚ # Result: 'BoneMarrow', 'Cortex', etc.            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: Iterate through each row of DataFrame      â”‚
â”‚                                                      â”‚
â”‚ for index, row in df.iterrows():                    â”‚
â”‚     # Process single row data                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 7: Extract and validate gene symbol           â”‚
â”‚                                                      â”‚
â”‚ gene_symbol = str(row.get('Gene_symbol', '')).strip()â”‚
â”‚ if not gene_symbol:                                 â”‚
â”‚     continue  # Skip empty gene symbols             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 8: Build MongoDB document                     â”‚
â”‚                                                      â”‚
â”‚ record = {                                          â”‚
â”‚     'organ': organ_name,                            â”‚
â”‚     'gene_symbol': gene_symbol,                     â”‚
â”‚     'gene_name': str(row.get('Gene_name', '')),    â”‚
â”‚     'p_value_10_mgkg_vs_control':                   â”‚
â”‚         str(row.get('P_value_10_mgkg_vs_control', '')),â”‚
â”‚     # ... 7 other fields                            â”‚
â”‚ }                                                   â”‚
â”‚ records.append(record)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 9: Build batch write operations               â”‚
â”‚                                                      â”‚
â”‚ operations = []                                     â”‚
â”‚ for record in records:                              â”‚
â”‚     operations.append({                             â”‚
â”‚         'replaceOne': {                             â”‚
â”‚             'filter': {                             â”‚
â”‚                 'organ': record['organ'],           â”‚
â”‚                 'gene_symbol': record['gene_symbol']â”‚
â”‚             },                                      â”‚
â”‚             'replacement': record,                  â”‚
â”‚             'upsert': True  # Insert if not exists, update if exists â”‚
â”‚         }                                           â”‚
â”‚     })                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 10: Execute batch write                       â”‚
â”‚                                                      â”‚
â”‚ result = collection.bulk_write(operations)          â”‚
â”‚ # Result statistics:                                â”‚
â”‚ # - result.upserted_count: number of new insertions â”‚
â”‚ # - result.modified_count: number of updates        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 11: Create indexes                            â”‚
â”‚                                                      â”‚
â”‚ collection.create_index([(&quot;gene_symbol&quot;, 1)])       â”‚
â”‚ collection.create_index([(&quot;organ&quot;, 1)])             â”‚
â”‚ collection.create_index(                            â”‚
â”‚     [(&quot;organ&quot;, 1), (&quot;gene_symbol&quot;, 1)],             â”‚
â”‚     unique=True                                     â”‚
â”‚ )                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Complete: Data loaded to MongoDB                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 id="22-gene-search-query-flow">2.2 Gene Search Query Flow<a class="headerlink" href="#22-gene-search-query-flow" title="Permanent link">&para;</a></h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User enters &quot;GAPDH&quot; in frontend and clicks search   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: gene-search/page.tsx                     â”‚
â”‚                                                      â”‚
â”‚ const handleSearch = async () =&gt; {                  â”‚
â”‚     setIsLoading(true)                              â”‚
â”‚     setError('')                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Build API request                                   â”‚
â”‚                                                      â”‚
â”‚ const url = `${API_BASE_URL}/api/gene/             â”‚
â”‚              symbol/search?gene_symbol=GAPDH`       â”‚
â”‚                                                      â”‚
â”‚ fetch(url, {                                        â”‚
â”‚     method: 'GET',                                  â”‚
â”‚     headers: {'Content-Type': 'application/json'}   â”‚
â”‚ })                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ HTTP GET Request
    â”‚ URL: http://localhost:8000/api/gene/symbol/search?gene_symbol=GAPDH
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FastAPI Route: @app.get(&quot;/api/gene/symbol/search&quot;) â”‚
â”‚                                                      â”‚
â”‚ async def search_gene_symbol(                       â”‚
â”‚     gene_symbol: str = Query(...)                   â”‚
â”‚ ):                                                  â”‚
â”‚     # FastAPI automatically parses query parameters â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Call business logic: gene_api.search_gene_data()   â”‚
â”‚                                                      â”‚
â”‚ def search_gene_data(self, gene_symbol: str):       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Build MongoDB query                        â”‚
â”‚                                                      â”‚
â”‚ query = {                                           â”‚
â”‚     &quot;gene_symbol&quot;: {                                â”‚
â”‚         &quot;$regex&quot;: &quot;^GAPDH$&quot;,  # Exact match         â”‚
â”‚         &quot;$options&quot;: &quot;i&quot;          # Case insensitive  â”‚
â”‚     }                                               â”‚
â”‚ }                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Execute MongoDB query                      â”‚
â”‚                                                      â”‚
â”‚ cursor = collection.find(query)                     â”‚
â”‚ # MongoDB uses gene_symbol index to speed up query  â”‚
â”‚ # Query complexity: O(log n)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Iterate through query results              â”‚
â”‚                                                      â”‚
â”‚ results = []                                        â”‚
â”‚ for doc in cursor:                                  â”‚
â”‚     # doc is a MongoDB document                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Format data                                 â”‚
â”‚                                                      â”‚
â”‚ results.append({                                    â”‚
â”‚     'organ': doc.get('organ', ''),                  â”‚
â”‚     'gene_symbol': doc.get('gene_symbol', ''),      â”‚
â”‚     'gene_name': doc.get('gene_name', ''),          â”‚
â”‚     'p_value': doc.get('p_value_10_mgkg_vs_control', ''),â”‚
â”‚     # ... other fields                              â”‚
â”‚ })                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: Return result list                          â”‚
â”‚                                                      â”‚
â”‚ return results  # List[Dict]                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FastAPI automatically serializes to JSON            â”‚
â”‚                                                      â”‚
â”‚ return {                                            â”‚
â”‚     &quot;gene_symbol&quot;: &quot;GAPDH&quot;,                         â”‚
â”‚     &quot;data&quot;: [                                       â”‚
â”‚         {                                           â”‚
â”‚             &quot;organ&quot;: &quot;Heart&quot;,                       â”‚
â”‚             &quot;gene_symbol&quot;: &quot;GAPDH&quot;,                 â”‚
â”‚             ...                                     â”‚
â”‚         },                                          â”‚
â”‚         {                                           â”‚
â”‚             &quot;organ&quot;: &quot;Liver&quot;,                       â”‚
â”‚             &quot;gene_symbol&quot;: &quot;GAPDH&quot;,                 â”‚
â”‚             ...                                     â”‚
â”‚         }                                           â”‚
â”‚     ]                                               â”‚
â”‚ }                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ HTTP 200 Response
    â”‚ Content-Type: application/json
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: Process response                          â”‚
â”‚                                                      â”‚
â”‚ const data = await response.json()                  â”‚
â”‚ setSearchResults(data.data)  # Update state         â”‚
â”‚ setIsLoading(false)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ React re-renders                                    â”‚
â”‚                                                      â”‚
â”‚ ResultsTable component displays data                 â”‚
â”‚ - Iterate through searchResults                     â”‚
â”‚ - Render table rows                                 â”‚
â”‚ - Display expression data for each organ            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 id="23-visualization-generation-flow">2.3 Visualization Generation Flow<a class="headerlink" href="#23-visualization-generation-flow" title="Permanent link">&para;</a></h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User clicks &quot;Show Fold Change Chart&quot; button         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: Call API                                  â”‚
â”‚                                                      â”‚
â”‚ fetch(`${API_BASE_URL}/api/gene/symbol/            â”‚
â”‚       showFoldChange?gene_symbol=GAPDH`)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: create_fold_change_plot()                 â”‚
â”‚                                                      â”‚
â”‚ Step 1: Query gene data                             â”‚
â”‚     results = search_gene_data(gene_symbol)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Extract data                                â”‚
â”‚                                                      â”‚
â”‚ organs = []                                         â”‚
â”‚ fold_changes = []                                   â”‚
â”‚ colors = []                                         â”‚
â”‚                                                      â”‚
â”‚ for doc in results:                                 â”‚
â”‚     fold_change = float(doc['fold_change_...'])     â”‚
â”‚     organs.append(doc['organ'])                     â”‚
â”‚     fold_changes.append(fold_change)                â”‚
â”‚     colors.append('blue' if fold_change &gt;= 0        â”‚
â”‚                    else 'red')                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Create matplotlib chart                    â”‚
â”‚                                                      â”‚
â”‚ fig, ax = plt.subplots(figsize=(10, 6))            â”‚
â”‚ ax.bar(organs, fold_changes, color=colors)         â”‚
â”‚ ax.set_title(f'Fold Change for {gene_symbol}')     â”‚
â”‚ ax.set_xlabel('Organ')                              â”‚
â”‚ ax.set_ylabel('Fold Change')                        â”‚
â”‚ plt.tight_layout()                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Convert to base64                           â”‚
â”‚                                                      â”‚
â”‚ buffer = io.BytesIO()                               â”‚
â”‚ plt.savefig(buffer, format='jpg', dpi=300)         â”‚
â”‚ buffer.seek(0)                                      â”‚
â”‚ image_base64 = base64.b64encode(                    â”‚
â”‚     buffer.getvalue()                               â”‚
â”‚ ).decode()                                          â”‚
â”‚ plt.close()                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: Return response                             â”‚
â”‚                                                      â”‚
â”‚ return {                                            â”‚
â”‚     &quot;gene_symbol&quot;: &quot;GAPDH&quot;,                         â”‚
â”‚     &quot;image_base64&quot;: &quot;iVBORw0KGgoAAAANSUhEUg...&quot;    â”‚
â”‚ }                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: Display image                             â”‚
â”‚                                                      â”‚
â”‚ &lt;img src={`data:image/jpeg;base64,${image_base64}`} â”‚
â”‚      alt=&quot;Fold Change Chart&quot; /&gt;                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr />
<h2 id="iii-theme-analysis-module-detailed-flow">III. Theme Analysis Module Detailed Flow<a class="headerlink" href="#iii-theme-analysis-module-detailed-flow" title="Permanent link">&para;</a></h2>
<h3 id="31-complete-analysis-flow">3.1 Complete Analysis Flow<a class="headerlink" href="#31-complete-analysis-flow" title="Permanent link">&para;</a></h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User uploads gene list file (.txt)                  â”‚
â”‚                                                      â”‚
â”‚ File content example:                               â”‚
â”‚ GAPDH                                               â”‚
â”‚ ACTB                                                â”‚
â”‚ TUBB                                                â”‚
â”‚ ...                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: Read file content                         â”‚
â”‚                                                      â”‚
â”‚ const fileContent = await file.text()               â”‚
â”‚ # Result: &quot;GAPDH\nACTB\nTUBB\n...&quot;                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Build FormData                                      â”‚
â”‚                                                      â”‚
â”‚ const formData = new FormData()                     â”‚
â”‚ formData.append('file', file)                       â”‚
â”‚ formData.append('selected_themes', JSON.stringify(  â”‚
â”‚     ['Inflammation &amp; immune signaling', ...]        â”‚
â”‚ ))                                                  â”‚
â”‚ formData.append('custom_themes', JSON.stringify([   â”‚
â”‚     {name: 'DNA Repair', keywords: [...]}           â”‚
â”‚ ]))                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ HTTP POST
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: /api/ontology/custom-analyze              â”‚
â”‚                                                      â”‚
â”‚ async def custom_analyze(                           â”‚
â”‚     file: UploadFile,                               â”‚
â”‚     selected_themes: str = Form(...),               â”‚
â”‚     custom_themes: str = Form(None)                 â”‚
â”‚ ):                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Parse request parameters                    â”‚
â”‚                                                      â”‚
â”‚ file_content = await file.read()                    â”‚
â”‚ file_content = file_content.decode('utf-8')         â”‚
â”‚                                                      â”‚
â”‚ selected_theme_names = json.loads(selected_themes)  â”‚
â”‚ custom_theme_data = json.loads(custom_themes) if custom_themes else []â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Load gene list                              â”‚
â”‚                                                      â”‚
â”‚ genes = ontology_api.load_genes_from_file(          â”‚
â”‚     file_content                                    â”‚
â”‚ )                                                   â”‚
â”‚ # Implementation:                                   â”‚
â”‚ # genes = []                                        â”‚
â”‚ # for line in file_content.strip().split('\n'):    â”‚
â”‚ #     gene = line.strip()                           â”‚
â”‚ #     if gene:                                      â”‚
â”‚ #         genes.append(gene)                        â”‚
â”‚ # return genes                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Temporarily add custom themes               â”‚
â”‚                                                      â”‚
â”‚ original_themes = ontology_api.themes.copy()        â”‚
â”‚                                                      â”‚
â”‚ for custom_theme in custom_theme_data:              â”‚
â”‚     theme_name = custom_theme.get('name')           â”‚
â”‚     keywords = custom_theme.get('keywords', [])     â”‚
â”‚     ontology_api.themes[theme_name] = keywords      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Execute enrichment analysis                 â”‚
â”‚                                                      â”‚
â”‚ enr_df = ontology_api.enrich(genes, p_thresh=1e-2) â”‚
â”‚                                                      â”‚
â”‚ # enrich() internal flow:                           â”‚
â”‚ # 1. Call GProfiler API:                            â”‚
â”‚ #    df = self.gp.profile(                          â”‚
â”‚ #        organism=&quot;mmusculus&quot;,                      â”‚
â”‚ #        query=genes                                â”‚
â”‚ #    )                                              â”‚
â”‚ # 2. Filter P-value:                                â”‚
â”‚ #    df = df[df[&quot;p_value&quot;] &lt; p_thresh]             â”‚
â”‚ # 3. Calculate Score:                               â”‚
â”‚ #    df[&quot;Score&quot;] = -np.log10(df[&quot;p_value&quot;])        â”‚
â”‚ # 4. Sort:                                          â”‚
â”‚ #    df = df.sort_values(&quot;p_value&quot;)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ GProfiler API call (external service)
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GProfiler server processing                         â”‚
â”‚                                                      â”‚
â”‚ 1. Receive gene list                                â”‚
â”‚ 2. Query GO database                                â”‚
â”‚ 3. Execute hypergeometric test for each GO term:    â”‚
â”‚    P(X â‰¥ k) = Î£ C(M,i) Ã— C(N-M,n-i) / C(N,n)      â”‚
â”‚    (i from k to min(n,M))                           â”‚
â”‚ 4. Calculate FDR correction                         â”‚
â”‚ 5. Return DataFrame                                 â”‚
â”‚    Columns: name, p_value, term_size, ...          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ Return DataFrame
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: Assign themes                               â”‚
â”‚                                                      â”‚
â”‚ enr_df[&quot;Theme&quot;] = enr_df[&quot;name&quot;].apply(             â”‚
â”‚     ontology_api.assign_theme                       â”‚
â”‚ )                                                   â”‚
â”‚                                                      â”‚
â”‚ # assign_theme() internal:                          â”‚
â”‚ # 1. go_term_lower = name.lower()                   â”‚
â”‚ # 2. for theme, keywords in themes.items():         â”‚
â”‚ #    for keyword in keywords:                       â”‚
â”‚ #        if keyword.lower() in go_term_lower:       â”‚
â”‚ #            return theme                           â”‚
â”‚ # 3. return None                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: Filter selected themes                      â”‚
â”‚                                                      â”‚
â”‚ if selected_theme_names:                            â”‚
â”‚     enr_df = enr_df[                                â”‚
â”‚         enr_df[&quot;Theme&quot;].isin(selected_theme_names)  â”‚
â”‚     ]                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 7: Aggregate themes                            â”‚
â”‚                                                      â”‚
â”‚ themed_df = ontology_api.aggregate(enr_df)          â”‚
â”‚                                                      â”‚
â”‚ # aggregate() internal:                             â”‚
â”‚ # 1. Remove GO terms without themes:                â”‚
â”‚ #    themed = df.dropna(subset=[&quot;Theme&quot;])           â”‚
â”‚ # 2. Group by theme:                                â”‚
â”‚ #    grouped = themed.groupby(&quot;Theme&quot;)              â”‚
â”‚ # 3. Aggregate calculation:                         â”‚
â”‚ #    aggregated = grouped.agg(                      â”‚
â”‚ #        Score=(&quot;Score&quot;, &quot;sum&quot;),                    â”‚
â”‚ #        Terms=(&quot;Theme&quot;, &quot;count&quot;)                   â”‚
â”‚ #    )                                              â”‚
â”‚ # 4. Sort:                                          â”‚
â”‚ #    aggregated = aggregated.sort_values(           â”‚
â”‚ #        &quot;Score&quot;, ascending=False                   â”‚
â”‚ #    )                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 8: Restore original themes                     â”‚
â”‚                                                      â”‚
â”‚ ontology_api.themes = original_themes               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 9: Prepare response data                       â”‚
â”‚                                                      â”‚
â”‚ results = []                                        â”‚
â”‚ for theme_name, row in themed_df.iterrows():        â”‚
â”‚     theme_go_terms = enr_df[                        â”‚
â”‚         enr_df[&quot;Theme&quot;] == theme_name               â”‚
â”‚     ]                                               â”‚
â”‚     results.append({                                â”‚
â”‚         &quot;theme&quot;: theme_name,                        â”‚
â”‚         &quot;score&quot;: float(row[&quot;Score&quot;]),               â”‚
â”‚         &quot;terms_count&quot;: int(row[&quot;Terms&quot;]),           â”‚
â”‚         &quot;go_terms&quot;: theme_go_terms.to_dict('records')â”‚
â”‚     })                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 10: Return JSON response                       â”‚
â”‚                                                      â”‚
â”‚ return {                                            â”‚
â”‚     &quot;results&quot;: results,                             â”‚
â”‚     &quot;message&quot;: &quot;Analysis completed&quot;                 â”‚
â”‚ }                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ HTTP 200 Response
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: Display results                           â”‚
â”‚                                                      â”‚
â”‚ setResults(data.results)                            â”‚
â”‚ # Render results table                              â”‚
â”‚ # Display theme, score, GO term count               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 id="32-theme-matching-algorithm-detailed-flow">3.2 Theme Matching Algorithm Detailed Flow<a class="headerlink" href="#32-theme-matching-algorithm-detailed-flow" title="Permanent link">&para;</a></h3>
<pre><code>Input: GO term name &quot;inflammatory response&quot;

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Convert to lowercase                        â”‚
â”‚                                                      â”‚
â”‚ go_term_lower = &quot;inflammatory response&quot;             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Iterate through all themes                  â”‚
â”‚                                                      â”‚
â”‚ for theme_name, keywords in themes.items():         â”‚
â”‚     # theme_name: &quot;Inflammation &amp; immune signaling&quot; â”‚
â”‚     # keywords: [&quot;inflammatory&quot;, &quot;immune&quot;, ...]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Iterate through theme keywords              â”‚
â”‚                                                      â”‚
â”‚ for keyword in keywords:                            â”‚
â”‚     # keyword: &quot;inflammatory&quot;                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Check if keyword is in GO term name         â”‚
â”‚                                                      â”‚
â”‚ if keyword.lower() in go_term_lower:                â”‚
â”‚     # &quot;inflammatory&quot; in &quot;inflammatory response&quot;      â”‚
â”‚     # â†’ True                                        â”‚
â”‚     return theme_name  # Return first matching themeâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Return: &quot;Inflammation &amp; immune signaling&quot;           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

If no match:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Return: None                                        â”‚
â”‚ (This GO term will be filtered out in aggregation) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr />
<h2 id="iv-ivcca-analysis-module-detailed-flow">IV. IVCCA Analysis Module Detailed Flow<a class="headerlink" href="#iv-ivcca-analysis-module-detailed-flow" title="Permanent link">&para;</a></h2>
<h3 id="41-data-loading-flow">4.1 Data Loading Flow<a class="headerlink" href="#41-data-loading-flow" title="Permanent link">&para;</a></h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User uploads data file (.xlsx/.csv/.tsv)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: POST /api/ivcca/load-data                â”‚
â”‚                                                      â”‚
â”‚ const formData = new FormData()                     â”‚
â”‚ formData.append('file', file)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend Processing                                  â”‚
â”‚                                                      â”‚
â”‚ Step 1: Create IVCCAAnalyzer instance               â”‚
â”‚     analyzer = IVCCAAnalyzer()                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Call analyzer.load_data(file_path)          â”‚
â”‚                                                      â”‚
â”‚ def load_data(self, file_path: str):                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Detect file type                            â”‚
â”‚                                                      â”‚
â”‚ if file_path.endswith('.xlsx'):                     â”‚
â”‚     df = pd.read_excel(file_path)                   â”‚
â”‚ elif file_path.endswith('.csv'):                    â”‚
â”‚     df = pd.read_csv(file_path)                     â”‚
â”‚ elif file_path.endswith('.tsv'):                    â”‚
â”‚     df = pd.read_csv(file_path, sep='\t')           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Extract data structure                      â”‚
â”‚                                                      â”‚
â”‚ sample_col = df.columns[0]                          â”‚
â”‚ self.sample_names = df[sample_col].tolist()         â”‚
â”‚ # Result: ['Sample1', 'Sample2', ...]              â”‚
â”‚                                                      â”‚
â”‚ self.gene_names = [col for col in df.columns[1:]]   â”‚
â”‚ # Result: ['Gene1', 'Gene2', ...]                  â”‚
â”‚                                                      â”‚
â”‚ self.data = df.iloc[:, 1:].values                   â”‚
â”‚ # Result: numpy array (samples Ã— genes)             â”‚
â”‚ # [[val11, val12, ...],                            â”‚
â”‚ #  [val21, val22, ...],                             â”‚
â”‚ #  ...]                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: Data type conversion and validation         â”‚
â”‚                                                      â”‚
â”‚ self.data = pd.DataFrame(self.data).apply(          â”‚
â”‚     pd.to_numeric, errors='coerce'                  â”‚
â”‚ ).values                                            â”‚
â”‚                                                      â”‚
â”‚ # Check NaN values:                                 â”‚
â”‚ nan_count = np.isnan(self.data).sum()               â”‚
â”‚ if nan_count &gt; 0:                                   â”‚
â”‚     print(f&quot;Warning: {nan_count} NaN values&quot;)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: Set status flags                            â”‚
â”‚                                                      â”‚
â”‚ self.data_loaded = True                             â”‚
â”‚ self.correlation_calculated = False                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 7: Generate data preview                       â”‚
â”‚                                                      â”‚
â”‚ preview = {                                         â”‚
â”‚     &quot;columns&quot;: [sample_col] + self.gene_names,      â”‚
â”‚     &quot;rows&quot;: [...]  # First few rows of data         â”‚
â”‚ }                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 8: Store analyzer in memory                    â”‚
â”‚                                                      â”‚
â”‚ analyzer_id = str(uuid.uuid4())                     â”‚
â”‚ analyzers[analyzer_id] = analyzer                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 9: Return response                             â”‚
â”‚                                                      â”‚
â”‚ return {                                            â”‚
â”‚     &quot;status&quot;: &quot;success&quot;,                            â”‚
â”‚     &quot;analyzer_id&quot;: analyzer_id,                     â”‚
â”‚     &quot;n_samples&quot;: self.data.shape[0],                â”‚
â”‚     &quot;n_genes&quot;: self.data.shape[1],                  â”‚
â”‚     &quot;preview&quot;: preview                              â”‚
â”‚ }                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 id="42-correlation-calculation-flow">4.2 Correlation Calculation Flow<a class="headerlink" href="#42-correlation-calculation-flow" title="Permanent link">&para;</a></h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User clicks &quot;Calculate Correlation&quot; button          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: POST /api/ivcca/calculate-correlation    â”‚
â”‚                                                      â”‚
â”‚ Body: {                                             â”‚
â”‚     &quot;analyzer_id&quot;: &quot;uuid-string&quot;,                   â”‚
â”‚     &quot;method&quot;: &quot;pearson&quot;                             â”‚
â”‚ }                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: Get analyzer from memory                   â”‚
â”‚                                                      â”‚
â”‚ analyzer = analyzers.get(analyzer_id)               â”‚
â”‚ if not analyzer:                                    â”‚
â”‚     raise HTTPException(404, &quot;Analyzer not found&quot;)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Call: analyzer.calculate_correlations(method)       â”‚
â”‚                                                      â”‚
â”‚ def calculate_correlations(self, method='pearson'): â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Check if data is loaded                     â”‚
â”‚                                                      â”‚
â”‚ if not self.data_loaded:                            â”‚
â”‚     return {&quot;status&quot;: &quot;error&quot;, ...}                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Convert to DataFrame                        â”‚
â”‚                                                      â”‚
â”‚ data_df = pd.DataFrame(                             â”‚
â”‚     self.data,                                      â”‚
â”‚     columns=self.gene_names                         â”‚
â”‚ )                                                   â”‚
â”‚ # Shape: (samples, genes)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Calculate correlation matrix                â”‚
â”‚                                                      â”‚
â”‚ if method == 'pearson':                             â”‚
â”‚     self.correlation_matrix = data_df.corr(         â”‚
â”‚         method='pearson'                            â”‚
â”‚     ).values                                        â”‚
â”‚ # pandas.corr() internal:                           â”‚
â”‚ # - Calculate Pearson correlation coefficient for each gene pair â”‚
â”‚ # - Return correlation matrix (genes Ã— genes)        â”‚
â”‚ # - Diagonal is 1 (autocorrelation)                  â”‚
â”‚ # - Matrix is symmetric                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Handle NaN values                           â”‚
â”‚                                                      â”‚
â”‚ self.correlation_matrix = np.nan_to_num(            â”‚
â”‚     self.correlation_matrix,                        â”‚
â”‚     nan=0.0                                         â”‚
â”‚ )                                                   â”‚
â”‚ # Replace NaN with 0 (usually due to constant values)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: Calculate statistics                        â”‚
â”‚                                                      â”‚
â”‚ # Extract upper triangle matrix (exclude diagonal and lower triangle) â”‚
â”‚ corr_values = self.correlation_matrix[              â”‚
â”‚     np.triu_indices_from(                           â”‚
â”‚         self.correlation_matrix,                    â”‚
â”‚         k=1                                         â”‚
â”‚     )                                               â”‚
â”‚ ]                                                   â”‚
â”‚                                                      â”‚
â”‚ stats = {                                           â”‚
â”‚     &quot;mean&quot;: float(np.mean(corr_values)),            â”‚
â”‚     &quot;std&quot;: float(np.std(corr_values)),              â”‚
â”‚     &quot;min&quot;: float(np.min(corr_values)),              â”‚
â”‚     &quot;max&quot;: float(np.max(corr_values)),              â”‚
â”‚     &quot;median&quot;: float(np.median(corr_values))         â”‚
â”‚ }                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: Set status flag                             â”‚
â”‚                                                      â”‚
â”‚ self.correlation_calculated = True                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 7: Return response                             â”‚
â”‚                                                      â”‚
â”‚ return {                                            â”‚
â”‚     &quot;status&quot;: &quot;success&quot;,                            â”‚
â”‚     &quot;matrix_size&quot;: self.correlation_matrix.shape,   â”‚
â”‚     &quot;statistics&quot;: stats                             â”‚
â”‚ }                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 id="43-matrix-sorting-flow">4.3 Matrix Sorting Flow<a class="headerlink" href="#43-matrix-sorting-flow" title="Permanent link">&para;</a></h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User clicks &quot;Sort&quot; button                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: analyzer.sort_correlation_matrix()         â”‚
â”‚                                                      â”‚
â”‚ def sort_correlation_matrix(self):                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Calculate mean absolute correlation for each gene â”‚
â”‚                                                      â”‚
â”‚ abs_corr = np.abs(self.correlation_matrix)          â”‚
â”‚ # Take absolute value: both positive and negative correlations considered â”‚
â”‚                                                      â”‚
â”‚ np.fill_diagonal(abs_corr, 0)                       â”‚
â”‚ # Set diagonal to 0 (exclude autocorrelation)       â”‚
â”‚                                                      â”‚
â”‚ gene_scores = np.mean(abs_corr, axis=1)             â”‚
â”‚ # Calculate mean for each row, get mean absolute correlation for each gene â”‚
â”‚ # gene_scores[i] = mean(|r_ij|) for j â‰  i          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Sort indices                                â”‚
â”‚                                                      â”‚
â”‚ sorted_indices = np.argsort(gene_scores)[::-1]      â”‚
â”‚ # argsort returns indices in ascending order        â”‚
â”‚ # [::-1] reverses to get descending order           â”‚
â”‚ # Result: [5, 12, 3, ...]  # Gene 5 has highest correlation â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Rearrange using sorted indices              â”‚
â”‚                                                      â”‚
â”‚ sorted_matrix = self.correlation_matrix[            â”‚
â”‚     sorted_indices[:, None],                        â”‚
â”‚     sorted_indices                                  â”‚
â”‚ ]                                                   â”‚
â”‚ # Rearrange both rows and columns                   â”‚
â”‚                                                      â”‚
â”‚ sorted_gene_names = [                               â”‚
â”‚     self.gene_names[i]                              â”‚
â”‚     for i in sorted_indices                         â”‚
â”‚ ]                                                   â”‚
â”‚                                                      â”‚
â”‚ sorted_scores = gene_scores[sorted_indices]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Return sorted results                       â”‚
â”‚                                                      â”‚
â”‚ return {                                            â”‚
â”‚     &quot;status&quot;: &quot;success&quot;,                            â”‚
â”‚     &quot;sorted_matrix&quot;: sorted_matrix.tolist(),        â”‚
â”‚     &quot;sorted_gene_names&quot;: sorted_gene_names,         â”‚
â”‚     &quot;sorted_scores&quot;: sorted_scores.tolist()         â”‚
â”‚ }                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 id="44-pca-analysis-flow">4.4 PCA Analysis Flow<a class="headerlink" href="#44-pca-analysis-flow" title="Permanent link">&para;</a></h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User clicks &quot;Perform PCA&quot; button                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: analyzer.perform_pca(n_components=3)       â”‚
â”‚                                                      â”‚
â”‚ def perform_pca(self, n_components=3):              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Use correlation matrix as input             â”‚
â”‚                                                      â”‚
â”‚ data = np.abs(self.correlation_matrix)              â”‚
â”‚ # Use absolute correlation matrix                   â”‚
â”‚ # Shape: (genes, genes)                             â”‚
â”‚ # Each gene is a &quot;sample&quot;, correlations between genes are &quot;features&quot; â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Fill NaN values                             â”‚
â”‚                                                      â”‚
â”‚ data_filled = np.nan_to_num(data, nan=0.0)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Execute PCA (using sklearn)                 â”‚
â”‚                                                      â”‚
â”‚ from sklearn.decomposition import PCA               â”‚
â”‚                                                      â”‚
â”‚ pca = PCA(n_components=25)  # Calculate 25 principal components â”‚
â”‚ pca.fit(data_filled)                                â”‚
â”‚                                                      â”‚
â”‚ # PCA internal steps:                               â”‚
â”‚ # 1. Standardize data (if needed)                   â”‚
â”‚ # 2. Calculate covariance matrix                     â”‚
â”‚ # 3. Eigendecomposition: C = Q Ã— Î› Ã— Q^T            â”‚
â”‚ # 4. Select top k principal components               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Calculate principal component scores        â”‚
â”‚                                                      â”‚
â”‚ pca_scores = pca.transform(data_filled)             â”‚
â”‚ # Shape: (genes, n_components)                      â”‚
â”‚ # Coordinates of each gene in principal component space â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: Calculate explained variance                â”‚
â”‚                                                      â”‚
â”‚ explained_variance = pca.explained_variance_ratio_  â”‚
â”‚ # Variance proportion explained by each principal component â”‚
â”‚ # Example: [0.25, 0.15, 0.10, ...]                 â”‚
â”‚ # PC1 explains 25% variance, PC2 explains 15%, etc. â”‚
â”‚                                                      â”‚
â”‚ cumulative_variance = np.cumsum(explained_variance) â”‚
â”‚ # Cumulative variance: [0.25, 0.40, 0.50, ...]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: Generate visualizations                     â”‚
â”‚                                                      â”‚
â”‚ # 6.1 Scree plot (cumulative variance)              â”‚
â”‚ fig = go.Figure()                                   â”‚
â”‚ fig.add_trace(go.Scatter(                           â”‚
â”‚     x=components,                                   â”‚
â”‚     y=cumulative_variance * 100,  # Convert to percentage â”‚
â”‚     mode='lines+markers'                            â”‚
â”‚ ))                                                  â”‚
â”‚                                                      â”‚
â”‚ # 6.2 3D scatter plot                               â”‚
â”‚ fig = go.Figure()                                   â”‚
â”‚ fig.add_trace(go.Scatter3d(                         â”‚
â”‚     x=pca_scores[:, 0],  # PC1                      â”‚
â”‚     y=pca_scores[:, 1],  # PC2                      â”‚
â”‚     z=pca_scores[:, 2],  # PC3                      â”‚
â”‚     text=gene_names,                                â”‚
â”‚     mode='markers'                                  â”‚
â”‚ ))                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 7: Convert to JSON (Plotly)                    â”‚
â”‚                                                      â”‚
â”‚ plot_data = fig.to_json()                           â”‚
â”‚ # Plotly chart configuration (JSON format)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 8: Return response                             â”‚
â”‚                                                      â”‚
â”‚ return {                                            â”‚
â”‚     &quot;status&quot;: &quot;success&quot;,                            â”‚
â”‚     &quot;scores&quot;: pca_scores.tolist(),                  â”‚
â”‚     &quot;explained_variance&quot;: explained_variance.tolist(),â”‚
â”‚     &quot;cumulative_variance&quot;: cumulative_variance.tolist(),â”‚
â”‚     &quot;scree_plot&quot;: {&quot;type&quot;: &quot;plotly&quot;, &quot;content&quot;: ...},â”‚
â”‚     &quot;scatter_plot&quot;: {&quot;type&quot;: &quot;plotly&quot;, &quot;content&quot;: ...}â”‚
â”‚ }                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: Render Plotly chart                       â”‚
â”‚                                                      â”‚
â”‚ &lt;Plot                                               â”‚
â”‚     data={JSON.parse(plot_data.content)}            â”‚
â”‚     layout={...}                                    â”‚
â”‚ /&gt;                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 id="45-multi-pathway-analysis-flow">4.5 Multi-Pathway Analysis Flow<a class="headerlink" href="#45-multi-pathway-analysis-flow" title="Permanent link">&para;</a></h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User selects multiple pathway files and clicks &quot;Analyze&quot; â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: analyzer.multi_pathway_analysis()          â”‚
â”‚                                                      â”‚
â”‚ def multi_pathway_analysis(                         â”‚
â”‚     self,                                           â”‚
â”‚     pathway_files: List[str],                       â”‚
â”‚     pathway_genes_list: List[List[str]],            â”‚
â”‚     sorted_genes: List[str] = None,                 â”‚
â”‚     sorted_correlations: List[float] = None         â”‚
â”‚ ):                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Iterate through each pathway                        â”‚
â”‚                                                      â”‚
â”‚ for pathway_file, pathway_genes in                  â”‚
â”‚     zip(pathway_files, pathway_genes_list):         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Find indices of pathway genes in dataset    â”‚
â”‚                                                      â”‚
â”‚ pathway_indices = []                                â”‚
â”‚ for gene in pathway_genes:                          â”‚
â”‚     gene_lower = gene.lower()                       â”‚
â”‚     if gene_lower in gene_names_lower:              â”‚
â”‚         idx = gene_names_lower.index(gene_lower)    â”‚
â”‚         pathway_indices.append(idx)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Check minimum gene count threshold          â”‚
â”‚                                                      â”‚
â”‚ if len(pathway_indices) &lt; min_genes_threshold:      â”‚
â”‚     continue  # Skip this pathway                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Calculate PCI_A (within-pathway correlation) â”‚
â”‚                                                      â”‚
â”‚ # Extract pathway correlation submatrix             â”‚
â”‚ pathway_corr = self.correlation_matrix[             â”‚
â”‚     np.ix_(pathway_indices, pathway_indices)        â”‚
â”‚ ]                                                   â”‚
â”‚ # Shape: (k, k) where k = len(pathway_indices)      â”‚
â”‚                                                      â”‚
â”‚ # Calculate absolute correlation                    â”‚
â”‚ abs_pathway_corr = np.abs(pathway_corr)             â”‚
â”‚ np.fill_diagonal(abs_pathway_corr, 0)               â”‚
â”‚                                                      â”‚
â”‚ # Calculate mean absolute correlation for each gene â”‚
â”‚ sum_abs_correlations = np.sum(                      â”‚
â”‚     abs_pathway_corr, axis=1                        â”‚
â”‚ )                                                   â”‚
â”‚ avg_abs_correlation = sum_abs_correlations / (      â”‚
â”‚     len(pathway_indices) - 1                        â”‚
â”‚ )                                                   â”‚
â”‚                                                      â”‚
â”‚ # Calculate PCI_A (within-pathway average)          â”‚
â”‚ pci_a = float(np.mean(avg_abs_correlation))         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Calculate PCI_B (extract from global sort)  â”‚
â”‚                                                      â”‚
â”‚ if sorted_genes and sorted_correlations:            â”‚
â”‚     pci_b_values = []                               â”‚
â”‚     for gene in pathway_genes:                      â”‚
â”‚         if gene in sorted_genes:                    â”‚
â”‚             idx = sorted_genes.index(gene)          â”‚
â”‚             pci_b_values.append(                    â”‚
â”‚                 sorted_correlations[idx]             â”‚
â”‚             )                                       â”‚
â”‚     pci_b = float(np.mean(pci_b_values))            â”‚
â”‚ else:                                               â”‚
â”‚     pci_b = None                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: Calculate PAI (Pathway Activation Index)    â”‚
â”‚                                                      â”‚
â”‚ pai = len(pathway_indices) / len(pathway_genes)     â”‚
â”‚ # Number of genes found in dataset / Total genes in pathway â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: Calculate CECI (Correlation-Expression Composite Index) â”‚
â”‚                                                      â”‚
â”‚ if pci_b is not None:                               â”‚
â”‚     ceci = pai * pci_b * 100                        â”‚
â”‚ else:                                               â”‚
â”‚     ceci = pai * pci_a * 100                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 7: Calculate Z-score                           â”‚
â”‚                                                      â”‚
â”‚ z_score = (ceci - 7.908) / 2.0605                  â”‚
â”‚ # 7.908: Mean CECI of random gene sets              â”‚
â”‚ # 2.0605: Standard deviation of CECI for random gene sets â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 8: Store results                               â”‚
â”‚                                                      â”‚
â”‚ results.append({                                    â”‚
â”‚     &quot;pathway_file&quot;: pathway_file,                   â”‚
â”‚     &quot;total_genes_in_pathway&quot;: len(pathway_genes),   â”‚
â”‚     &quot;genes_found_in_set&quot;: len(pathway_indices),     â”‚
â”‚     &quot;pai&quot;: float(pai),                              â”‚
â”‚     &quot;pci_a&quot;: pci_a,                                 â”‚
â”‚     &quot;pci_b&quot;: pci_b,                                 â”‚
â”‚     &quot;ceci&quot;: float(ceci),                            â”‚
â”‚     &quot;z_score&quot;: float(z_score)                       â”‚
â”‚ })                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 9: Sort by CECI                                â”‚
â”‚                                                      â”‚
â”‚ results.sort(                                       â”‚
â”‚     key=lambda x: x[&quot;ceci&quot;]                         â”‚
â”‚     if x[&quot;ceci&quot;] is not None                        â”‚
â”‚     else -float('inf'),                             â”‚
â”‚     reverse=True                                    â”‚
â”‚ )                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 10: Return results                             â”‚
â”‚                                                      â”‚
â”‚ return {                                            â”‚
â”‚     &quot;status&quot;: &quot;success&quot;,                            â”‚
â”‚     &quot;pathways&quot;: results,                            â”‚
â”‚     &quot;n_pathways&quot;: len(results)                      â”‚
â”‚ }                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr />
<h2 id="v-component-interaction-relationships">V. Component Interaction Relationships<a class="headerlink" href="#v-component-interaction-relationships" title="Permanent link">&para;</a></h2>
<h3 id="51-frontend-component-interactions">5.1 Frontend Component Interactions<a class="headerlink" href="#51-frontend-component-interactions" title="Permanent link">&para;</a></h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   RootLayout    â”‚
â”‚  (layout.tsx)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                          â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                            â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚  Page    â”‚                            â”‚  Navigation â”‚
    â”‚ Componentâ”‚                            â”‚  Component  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                  â”‚                   â”‚             â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ GeneSearch   â”‚  â”‚ ThemeAnalysis â”‚  â”‚ IVCCA Analysis â”‚
    â”‚ Page         â”‚  â”‚ Page          â”‚  â”‚ Page           â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                  â”‚                   â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ SearchInput  â”‚  â”‚ FileUpload    â”‚  â”‚ DataUpload     â”‚
    â”‚ Component    â”‚  â”‚ Component     â”‚  â”‚ Component      â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                  â”‚                   â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ResultsTable â”‚  â”‚ ThemeSelector â”‚  â”‚ AnalysisControlsâ”‚
    â”‚ Component    â”‚  â”‚ Component     â”‚  â”‚ Component       â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                  â”‚                   â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ PlotDisplay  â”‚  â”‚ ChartDisplay  â”‚  â”‚ Visualization  â”‚
    â”‚ Component    â”‚  â”‚ Component     â”‚  â”‚ Panel          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

All components communicate via:
â”œâ”€â†’ Props passing (parent â†’ child)
â”œâ”€â†’ State lifting (child â†’ parent via callback functions)
â””â”€â†’ API calls (component â†’ backend)
</code></pre>
<h3 id="52-backend-class-interactions">5.2 Backend Class Interactions<a class="headerlink" href="#52-backend-class-interactions" title="Permanent link">&para;</a></h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         FastAPI App                  â”‚
â”‚         (server.py)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                  â”‚                  â”‚              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚GeneSearchAPIâ”‚   â”‚GeneOntologyAPIâ”‚   â”‚IVCCAAnalyzer    â”‚
    â”‚             â”‚   â”‚               â”‚   â”‚(ivcca_core.py)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                  â”‚                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   MongoDB   â”‚   â”‚ GProfiler    â”‚   â”‚  NumPy/SciPy    â”‚
    â”‚  Collection â”‚   â”‚    API       â”‚   â”‚  scikit-learn   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Data flow:
â”œâ”€â†’ GeneSearchAPI â†â†’ MongoDB
â”œâ”€â†’ GeneOntologyAPI â†’ GProfiler API â†’ Enrichment results
â””â”€â†’ IVCCAAnalyzer â†’ Algorithm libraries â†’ Analysis results
</code></pre>
<h3 id="53-data-flow-overview">5.3 Data Flow Overview<a class="headerlink" href="#53-data-flow-overview" title="Permanent link">&para;</a></h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Actions â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Frontend Components           â”‚
â”‚        (React State)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ HTTP Request (JSON)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      FastAPI Routes                  â”‚
â”‚      (Request Validation)            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚              â”‚              â”‚              â”‚
       â–¼              â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚MongoDB   â”‚  â”‚GProfiler APIâ”‚  â”‚Algorithm â”‚  â”‚File      â”‚
â”‚Query/Writeâ”‚  â”‚Enrichment   â”‚  â”‚Computing â”‚  â”‚System    â”‚
â”‚          â”‚  â”‚             â”‚  â”‚(NumPy etc)â”‚  â”‚(Excel)   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚              â”‚               â”‚             â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Data Processing and â”‚
          â”‚     Computation      â”‚
          â”‚   (Business Logic)   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   Response Generation â”‚
          â”‚    (JSON/Base64)     â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ HTTP Response
                     â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Frontend State Updateâ”‚
          â”‚    (React Re-render) â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  User Sees Results   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr />
<h2 id="vi-key-algorithm-execution-flow">VI. Key Algorithm Execution Flow<a class="headerlink" href="#vi-key-algorithm-execution-flow" title="Permanent link">&para;</a></h2>
<h3 id="61-pearson-correlation-coefficient-calculation-detailed">6.1 Pearson Correlation Coefficient Calculation (Detailed)<a class="headerlink" href="#61-pearson-correlation-coefficient-calculation-detailed" title="Permanent link">&para;</a></h3>
<pre><code>Input: Two gene expression vectors
X = [x1, x2, ..., xn]  (n samples)
Y = [y1, y2, ..., yn]

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Calculate mean                              â”‚
â”‚                                                      â”‚
â”‚ x_mean = (x1 + x2 + ... + xn) / n                   â”‚
â”‚ y_mean = (y1 + y2 + ... + yn) / n                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Calculate covariance numerator              â”‚
â”‚                                                      â”‚
â”‚ numerator = Î£(xi - x_mean) Ã— (yi - y_mean)         â”‚
â”‚           = (x1-x_mean)(y1-y_mean) +                â”‚
â”‚             (x2-x_mean)(y2-y_mean) +                â”‚
â”‚             ... +                                   â”‚
â”‚             (xn-x_mean)(yn-y_mean)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Calculate standard deviation                â”‚
â”‚                                                      â”‚
â”‚ x_var = Î£(xi - x_mean)Â²                            â”‚
â”‚       = (x1-x_mean)Â² + (x2-x_mean)Â² + ...          â”‚
â”‚                                                      â”‚
â”‚ y_var = Î£(yi - y_mean)Â²                            â”‚
â”‚       = (y1-y_mean)Â² + (y2-y_mean)Â² + ...          â”‚
â”‚                                                      â”‚
â”‚ x_std = âˆšx_var                                      â”‚
â”‚ y_std = âˆšy_var                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Calculate correlation coefficient           â”‚
â”‚                                                      â”‚
â”‚ r = numerator / (x_std Ã— y_std)                     â”‚
â”‚                                                      â”‚
â”‚ If denominator == 0:                                â”‚
â”‚     r = NaN  # One of the genes has no variation    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Output: r âˆˆ [-1, 1]                                 â”‚
â”‚                                                      â”‚
â”‚ r = 1:  Perfect positive correlation                â”‚
â”‚ r = 0:  No linear correlation                       â”‚
â”‚ r = -1: Perfect negative correlation                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Vectorized implementation (pandas):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ data_df.corr(method='pearson')                      â”‚
â”‚                                                      â”‚
â”‚ Internally performs above calculation for each gene pair, building correlation matrix â”‚
â”‚ Time complexity: O(n Ã— mÂ²) where n=sample count, m=gene count â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 id="62-ceci-calculation-flow-detailed">6.2 CECI Calculation Flow (Detailed)<a class="headerlink" href="#62-ceci-calculation-flow-detailed" title="Permanent link">&para;</a></h3>
<pre><code>Input:
- pathway_genes: ['Gene1', 'Gene2', ...]  # Pathway gene list
- sorted_genes: ['Gene5', 'Gene12', ...]  # Globally sorted genes
- sorted_correlations: [0.85, 0.82, ...]  # Corresponding correlation scores

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Match pathway genes to dataset              â”‚
â”‚                                                      â”‚
â”‚ pathway_indices = []                                â”‚
â”‚ for gene in pathway_genes:                          â”‚
â”‚     if gene in dataset_genes:                       â”‚
â”‚         idx = find_index(gene)                      â”‚
â”‚         pathway_indices.append(idx)                 â”‚
â”‚                                                      â”‚
â”‚ # Example:                                          â”‚
â”‚ # pathway_genes = ['GAPDH', 'ACTB', 'TUBB']        â”‚
â”‚ # pathway_indices = [5, 12, 23]  # Indices in dataset â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Calculate PCI_A (within-pathway correlation) â”‚
â”‚                                                      â”‚
â”‚ # 2.1 Extract pathway correlation submatrix         â”‚
â”‚ pathway_corr = correlation_matrix[                  â”‚
â”‚     pathway_indices, :][:, pathway_indices]         â”‚
â”‚ # Shape: (k, k) where k = len(pathway_indices)      â”‚
â”‚                                                      â”‚
â”‚ # 2.2 Calculate absolute correlation                â”‚
â”‚ abs_pathway_corr = |pathway_corr|                   â”‚
â”‚ abs_pathway_corr[diagonal] = 0  # Exclude autocorrelation â”‚
â”‚                                                      â”‚
â”‚ # 2.3 Calculate mean absolute correlation for each gene â”‚
â”‚ for i in range(k):                                  â”‚
â”‚     Q_i = mean(abs_pathway_corr[i, :])              â”‚
â”‚     # Exclude diagonal, so divide by (k-1)          â”‚
â”‚                                                      â”‚
â”‚ # 2.4 Calculate PCI_A                               â”‚
â”‚ PCI_A = mean([Q_1, Q_2, ..., Q_k])                  â”‚
â”‚       = mean(Q_i) for all i in pathway              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Calculate PCI_B (global correlation)        â”‚
â”‚                                                      â”‚
â”‚ if sorted_genes provided:                           â”‚
â”‚     pci_b_values = []                               â”‚
â”‚     for gene in pathway_genes:                      â”‚
â”‚         if gene in sorted_genes:                    â”‚
â”‚             idx = sorted_genes.index(gene)          â”‚
â”‚             Q_global = sorted_correlations[idx]     â”‚
â”‚             pci_b_values.append(Q_global)           â”‚
â”‚                                                      â”‚
â”‚     PCI_B = mean(pci_b_values)                      â”‚
â”‚ else:                                               â”‚
â”‚     PCI_B = None                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Calculate PAI (Pathway Activation Index)    â”‚
â”‚                                                      â”‚
â”‚ PAI = genes_found / total_genes                     â”‚
â”‚     = len(pathway_indices) / len(pathway_genes)     â”‚
â”‚                                                      â”‚
â”‚ # Example:                                          â”‚
â”‚ # pathway_genes has 100 genes                       â”‚
â”‚ # 45 found in dataset                               â”‚
â”‚ # PAI = 45/100 = 0.45                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: Calculate CECI                              â”‚
â”‚                                                      â”‚
â”‚ if PCI_B is not None:                               â”‚
â”‚     CECI = PAI Ã— PCI_B Ã— 100                        â”‚
â”‚ else:                                               â”‚
â”‚     CECI = PAI Ã— PCI_A Ã— 100                        â”‚
â”‚                                                      â”‚
â”‚ # Example:                                          â”‚
â”‚ # PAI = 0.45                                        â”‚
â”‚ # PCI_B = 0.72                                      â”‚
â”‚ # CECI = 0.45 Ã— 0.72 Ã— 100 = 32.4                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: Calculate Z-score                           â”‚
â”‚                                                      â”‚
â”‚ # Background distribution parameters (calculated from random gene sets) â”‚
â”‚ background_mean = 7.908                             â”‚
â”‚ background_std = 2.0605                             â”‚
â”‚                                                      â”‚
â”‚ Z = (CECI - background_mean) / background_std       â”‚
â”‚   = (32.4 - 7.908) / 2.0605                         â”‚
â”‚   = 11.87                                           â”‚
â”‚                                                      â”‚
â”‚ # Critical Z-value (Î±=0.05):                        â”‚
â”‚ Z_critical = 1.96                                   â”‚
â”‚                                                      â”‚
â”‚ # Judgment:                                         â”‚
â”‚ if |Z| &gt; Z_critical:                                â”‚
â”‚     Pathway significantly activated (or suppressed)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr />
<h2 id="vii-memory-management-and-state-persistence">VII. Memory Management and State Persistence<a class="headerlink" href="#vii-memory-management-and-state-persistence" title="Permanent link">&para;</a></h2>
<h3 id="71-backend-memory-management">7.1 Backend Memory Management<a class="headerlink" href="#71-backend-memory-management" title="Permanent link">&para;</a></h3>
<p><strong>IVCCA Analyzer Instance Storage</strong>:</p>
<pre><code class="language-python"># Global dictionary (in memory)
analyzers: Dict[str, IVCCAAnalyzer] = {}

# Create new instance
analyzer_id = str(uuid.uuid4())
analyzers[analyzer_id] = IVCCAAnalyzer()

# Get instance
analyzer = analyzers.get(analyzer_id)
</code></pre>
<p><strong>Memory Usage</strong>:</p>
<pre><code>Memory usage per analyzer instance:
â”œâ”€ self.data: (samples, genes) Ã— 8 bytes (float64)
â”œâ”€ self.correlation_matrix: (genes, genes) Ã— 8 bytes
â””â”€ Other variables: ~few MB

Example: 1000 genes, 100 samples
â”œâ”€ data: 100 Ã— 1000 Ã— 8 = 800 KB
â””â”€ correlation_matrix: 1000 Ã— 1000 Ã— 8 = 8 MB
Total: ~10 MB per analyzer
</code></pre>
<p><strong>Lifecycle Management</strong>:</p>
<ul>
<li>Instances remain in memory until server restart</li>
<li>No automatic cleanup mechanism (can add TTL)</li>
<li>Supports multiple users analyzing simultaneously (each user has independent analyzer_id)</li>
</ul>
<h3 id="72-frontend-state-management">7.2 Frontend State Management<a class="headerlink" href="#72-frontend-state-management" title="Permanent link">&para;</a></h3>
<p><strong>State Lifecycle</strong>:</p>
<pre><code>Component mount
    â”‚
    â”œâ”€â†’ useState initialization
    â”œâ”€â†’ useEffect execution
    â””â”€â†’ Initial render
    â”‚
User action
    â”‚
    â”œâ”€â†’ State update (setState)
    â””â”€â†’ React re-render
    â”‚
Component unmount
    â”‚
    â””â”€â†’ State cleanup
</code></pre>
<p><strong>Persistent Storage</strong>:</p>
<pre><code class="language-typescript">// localStorage (browser storage)
localStorage.setItem('authToken', token);      // Authentication token
localStorage.setItem('isLoggedIn', 'true');    // Login status

// Session-level storage (lost after page refresh)
// - All useState states
// - API response data
// - UI states
</code></pre>
<hr />
<h2 id="viii-error-handling-and-exception-flow">VIII. Error Handling and Exception Flow<a class="headerlink" href="#viii-error-handling-and-exception-flow" title="Permanent link">&para;</a></h2>
<h3 id="81-frontend-error-handling-flow">8.1 Frontend Error Handling Flow<a class="headerlink" href="#81-frontend-error-handling-flow" title="Permanent link">&para;</a></h3>
<pre><code>API call
    â”‚
    â”œâ”€â†’ Success (response.ok === true)
    â”‚     â”‚
    â”‚     â””â”€â†’ Parse JSON â†’ Update state â†’ Display results
    â”‚
    â””â”€â†’ Failure
          â”‚
          â”œâ”€â†’ Network error (fetch error)
          â”‚     â”‚
          â”‚     â””â”€â†’ catch block â†’ setError() â†’ Display error message
          â”‚
          â””â”€â†’ HTTP error (response.ok === false)
                â”‚
                â”œâ”€â†’ 400: Client error â†’ Display error details
                â”œâ”€â†’ 401: Unauthorized â†’ Redirect to login page
                â”œâ”€â†’ 404: Resource not found â†’ Display &quot;Not found&quot;
                â””â”€â†’ 500: Server error â†’ Display &quot;Server error&quot;
</code></pre>
<h3 id="82-backend-error-handling-flow">8.2 Backend Error Handling Flow<a class="headerlink" href="#82-backend-error-handling-flow" title="Permanent link">&para;</a></h3>
<pre><code>Request received
    â”‚
    â”œâ”€â†’ Parameter validation failed (Pydantic)
    â”‚     â”‚
    â”‚     â””â”€â†’ Automatically return 422 (Unprocessable Entity)
    â”‚
    â”œâ”€â†’ Business logic error
    â”‚     â”‚
    â”‚     â”œâ”€â†’ ValueError â†’ HTTPException(400)
    â”‚     â”œâ”€â†’ KeyError â†’ HTTPException(404)
    â”‚     â””â”€â†’ Exception â†’ HTTPException(500)
    â”‚
    â””â”€â†’ Success
          â”‚
          â””â”€â†’ Return JSON response (200)
</code></pre>
<hr />
<h2 id="ix-performance-optimization-details">IX. Performance Optimization Details<a class="headerlink" href="#ix-performance-optimization-details" title="Permanent link">&para;</a></h2>
<h3 id="91-database-query-optimization">9.1 Database Query Optimization<a class="headerlink" href="#91-database-query-optimization" title="Permanent link">&para;</a></h3>
<p><strong>Index Usage</strong>:</p>
<pre><code>Query: {&quot;gene_symbol&quot;: {&quot;$regex&quot;: &quot;^GAPDH$&quot;, &quot;$options&quot;: &quot;i&quot;}}

Without index:
â”œâ”€ Full table scan: O(n)
â””â”€ Time complexity: High

With index:
â”œâ”€ Index lookup: O(log n)
â””â”€ Time complexity: Low (logarithmic)

Index structure (B-Tree):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ACTB â†’ doc1 â”‚
â”‚ ACTB â†’ doc2 â”‚
â”‚ ACTB â†’ doc3 â”‚
â”‚ ...         â”‚
â”‚ GAPDH â†’ doc5â”‚  â† Quick positioning
â”‚ GAPDH â†’ doc6â”‚
â”‚ ...         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 id="92-correlation-calculation-optimization">9.2 Correlation Calculation Optimization<a class="headerlink" href="#92-correlation-calculation-optimization" title="Permanent link">&para;</a></h3>
<p><strong>Vectorized Calculation</strong>:</p>
<pre><code>Traditional loop approach:
for i in range(n_genes):
    for j in range(i+1, n_genes):
        r[i,j] = calculate_correlation(data[:,i], data[:,j])
Time complexity: O(nÂ² Ã— m) where m=sample count

Vectorized approach (pandas):
correlation_matrix = data_df.corr()
Time complexity: O(nÂ² Ã— m) but actually faster (underlying optimization)

NumPy optimization:
- Use BLAS library (linear algebra library)
- Multi-threaded computation
- SIMD instruction set acceleration
</code></pre>
<h3 id="93-frontend-rendering-optimization">9.3 Frontend Rendering Optimization<a class="headerlink" href="#93-frontend-rendering-optimization" title="Permanent link">&para;</a></h3>
<p><strong>React Optimization</strong>:</p>
<pre><code>1. Use useMemo to cache computation results
   const filteredResults = useMemo(() =&gt; {
       return results.filter(...);
   }, [results]);

2. Use useCallback to cache functions
   const handleClick = useCallback(() =&gt; {
       // ...
   }, [dependencies]);

3. Code splitting (dynamic imports)
   const Plot = dynamic(() =&gt; import('react-plotly.js'));
</code></pre>
<hr />
<h2 id="x-deployment-and-runtime-flow">X. Deployment and Runtime Flow<a class="headerlink" href="#x-deployment-and-runtime-flow" title="Permanent link">&para;</a></h2>
<h3 id="101-development-environment-startup-flow">10.1 Development Environment Startup Flow<a class="headerlink" href="#101-development-environment-startup-flow" title="Permanent link">&para;</a></h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Start Backend               â”‚
â”‚                                     â”‚
â”‚ cd backend                          â”‚
â”‚ python server.py                    â”‚
â”‚                                     â”‚
â”‚ Or:                                 â”‚
â”‚ uvicorn server:app --reload         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€â†’ Load environment variables
    â”œâ”€â†’ Connect to MongoDB
    â”œâ”€â†’ Initialize API classes
    â”œâ”€â†’ Start FastAPI server
    â””â”€â†’ Listen on port 8000
    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Start Frontend              â”‚
â”‚                                     â”‚
â”‚ cd genegen                          â”‚
â”‚ npm run dev                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€â†’ Compile TypeScript
    â”œâ”€â†’ Start Next.js development server
    â””â”€â†’ Listen on port 3000
    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Browser Access              â”‚
â”‚                                     â”‚
â”‚ http://localhost:3000               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 id="102-production-environment-deployment-flow">10.2 Production Environment Deployment Flow<a class="headerlink" href="#102-production-environment-deployment-flow" title="Permanent link">&para;</a></h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Build Frontend              â”‚
â”‚                                     â”‚
â”‚ cd genegen                          â”‚
â”‚ npm run build                       â”‚
â”‚ # Generate .next directory          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Docker Build                â”‚
â”‚                                     â”‚
â”‚ docker-compose build                â”‚
â”‚ # Build backend and frontend images â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Start Containers            â”‚
â”‚                                     â”‚
â”‚ docker-compose up -d                â”‚
â”‚ # Run all services in background    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Nginx Reverse Proxy (Optional) â”‚
â”‚                                     â”‚
â”‚ Configure Nginx to forward requests â”‚
â”‚ /api/* â†’ backend:8000              â”‚
â”‚ /* â†’ frontend:3000                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr />
<h2 id="xi-key-technical-decision-explanations">XI. Key Technical Decision Explanations<a class="headerlink" href="#xi-key-technical-decision-explanations" title="Permanent link">&para;</a></h2>
<h3 id="111-why-choose-mongodb">11.1 Why Choose MongoDB?<a class="headerlink" href="#111-why-choose-mongodb" title="Permanent link">&para;</a></h3>
<p><strong>Reasons</strong>:<br />
1. <strong>Flexible data model</strong>: Different organs may have different numbers of genes, document model is more flexible<br />
2. <strong>Rapid development</strong>: No need to predefine schema<br />
3. <strong>Horizontal scaling</strong>: Supports sharding and replica sets<br />
4. <strong>Index support</strong>: B-tree indexes accelerate queries</p>
<p><strong>Alternatives</strong>:<br />
- PostgreSQL: Requires predefined table structure, but supports SQL queries<br />
- SQLite: Lightweight, but not suitable for concurrency</p>
<h3 id="112-why-choose-fastapi">11.2 Why Choose FastAPI?<a class="headerlink" href="#112-why-choose-fastapi" title="Permanent link">&para;</a></h3>
<p><strong>Reasons</strong>:<br />
1. <strong>Performance</strong>: Based on Starlette, async support, performance close to Node.js<br />
2. <strong>Auto documentation</strong>: OpenAPI/Swagger auto-generation<br />
3. <strong>Type safety</strong>: Pydantic models automatically validate<br />
4. <strong>Python ecosystem</strong>: Can use all Python scientific computing libraries</p>
<p><strong>Alternatives</strong>:<br />
- Django: Too heavy, suitable for full-stack applications<br />
- Flask: Lightweight but lacks auto documentation and type validation</p>
<h3 id="113-why-choose-nextjs">11.3 Why Choose Next.js?<a class="headerlink" href="#113-why-choose-nextjs" title="Permanent link">&para;</a></h3>
<p><strong>Reasons</strong>:<br />
1. <strong>Server-side rendering</strong>: SEO friendly<br />
2. <strong>File system routing</strong>: Simple and intuitive<br />
3. <strong>Automatic code splitting</strong>: Optimizes loading performance<br />
4. <strong>React ecosystem</strong>: Can use all React libraries</p>
<p><strong>Alternatives</strong>:<br />
- Create React App: Lacks SSR and routing<br />
- Vue.js: Different technology stack</p>
<hr />
<h2 id="xii-system-extension-points">XII. System Extension Points<a class="headerlink" href="#xii-system-extension-points" title="Permanent link">&para;</a></h2>
<h3 id="121-data-extension">12.1 Data Extension<a class="headerlink" href="#121-data-extension" title="Permanent link">&para;</a></h3>
<p><strong>Adding New Organs</strong>:</p>
<pre><code>1. Place new Excel file in backend/data/
2. Restart backend server
3. GeneSearchAPI.__init__() automatically loads new data
</code></pre>
<p><strong>Adding New Fields</strong>:</p>
<pre><code>1. Modify Excel file, add new columns
2. Modify GeneData model (server.py)
3. Modify data loading logic
4. Modify frontend display components
</code></pre>
<h3 id="122-feature-extension">12.2 Feature Extension<a class="headerlink" href="#122-feature-extension" title="Permanent link">&para;</a></h3>
<p><strong>Adding New Analysis Algorithms</strong>:</p>
<pre><code>1. Add new method in ivcca_core.py
2. Add new API endpoint in server.py
3. Add new UI component in frontend
</code></pre>
<p><strong>Adding New Visualization Types</strong>:</p>
<pre><code>1. Create new chart generation function in backend
2. Use matplotlib/Plotly to generate charts
3. Return base64 or Plotly JSON
4. Frontend renders charts
</code></pre>
<hr />
<p><strong>Document Version</strong>: 1.0<br />
<strong>Last Updated</strong>: 2024</p>
    
    <script>
        // Print hint
        window.onbeforeprint = function() {
            console.log("Print hint: Please select 'Save as PDF' or 'Print to PDF'");
        };
    </script>
</body>
</html>