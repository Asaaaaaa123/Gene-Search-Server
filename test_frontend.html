<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frontend Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .theme { margin: 5px 0; padding: 5px; background: #f0f0f0; }
    </style>
</head>
<body>
    <h1>Frontend Data Test</h1>
    
    <button onclick="testAPI()">Test API Call</button>
    <button onclick="testDataProcessing()">Test Data Processing</button>
    
    <div id="results"></div>

    <script>
        const API_BASE_URL = 'http://localhost:8001';
        
        async function testAPI() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<h2>API Test Results:</h2>';
            
            try {
                // 读取基因文件
                const response = await fetch('/885_genes.txt');
                const fileContent = await response.text();
                
                // 创建FormData
                const formData = new FormData();
                const file = new File([fileContent], '885_genes.txt', { type: 'text/plain' });
                formData.append('file', file);
                
                // 调用API
                const apiResponse = await fetch(`${API_BASE_URL}/api/ontology/analyze`, {
                    method: 'POST',
                    body: formData,
                });
                
                if (!apiResponse.ok) {
                    throw new Error(`HTTP error! status: ${apiResponse.status}`);
                }
                
                const data = await apiResponse.json();
                
                resultsDiv.innerHTML += `
                    <div class="result">
                        <h3>API Response:</h3>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                        
                        <h3>Results Array:</h3>
                        <p>Length: ${data.results ? data.results.length : 0}</p>
                        
                        <h3>Themes:</h3>
                        ${data.results ? data.results.map(result => 
                            `<div class="theme">${result.theme}: Score=${result.score.toFixed(2)}, Terms=${result.terms}</div>`
                        ).join('') : 'No results'}
                    </div>
                `;
                
            } catch (error) {
                resultsDiv.innerHTML += `<div class="result" style="color: red;">Error: ${error.message}</div>`;
            }
        }
        
        function testDataProcessing() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<h2>Data Processing Test:</h2>';
            
            // 模拟API响应数据
            const mockData = {
                results: [
                    { theme: "Extracellular matrix & adhesion", score: 236.68, terms: 32 },
                    { theme: "Metabolic re-wiring", score: 188.33, terms: 51 },
                    { theme: "Stress & cytokine response", score: 61.74, terms: 12 },
                    { theme: "Hematopoietic & immune commitment", score: 41.59, terms: 12 },
                    { theme: "Inflammation & immune signaling", score: 36.99, terms: 7 },
                    { theme: "Neuronal Excitability & Synapse", score: 32.58, terms: 10 },
                    { theme: "Oxidative stress & redox regulation", score: 26.82, terms: 7 },
                    { theme: "Neurotrophic Signaling & Growth Factors", score: 24.78, terms: 7 },
                    { theme: "Pain & Nociception", score: 2.17, terms: 1 }
                ]
            };
            
            const results = mockData.results || [];
            
            resultsDiv.innerHTML += `
                <div class="result">
                    <h3>Mock Data Processing:</h3>
                    <p>Results length: ${results.length}</p>
                    
                    <h3>Themes:</h3>
                    ${results.map(result => 
                        `<div class="theme">${result.theme}: Score=${result.score.toFixed(2)}, Terms=${result.terms}</div>`
                    ).join('')}
                </div>
            `;
        }
    </script>
</body>
</html> 